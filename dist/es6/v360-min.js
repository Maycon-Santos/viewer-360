Object.prototype.merge=function(e){for(const t in e)this[t]=e[t]};class V360{constructor(){const e=document.querySelectorAll("[v360], [V360]");for(let t=0,r=e.length;t<r;t++)this.init(e[t]);return"teste"}init(e){if(e.v360&&e.v360.played)return e.v360.restart();const t={target:e,srcs:void 0,sprite:void 0,frames:0,dragSensitivity:5,canvas:this.appendCanvas(e),imgs:[],currentFrame:0,allowDrag:!0,mousePressing:void 0,mouseStart:0,loadedImages:0};t.merge(JSON.parse(e.getAttribute("v360").replace(/\'/g,'"'))),this.preload(t),this.onresize(t),this.V360DOM(e,t)}}window.addEventListener("load",()=>window.v360=new V360),V360.prototype.appendCanvas=function(e){let t={};return t.target=document.createElement("canvas"),this.resizeCanvas(e,t.target),t.ctx=t.target.getContext("2d"),e.appendChild(t.target),t},V360.prototype.easingFunctions={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}},V360.prototype.preload=function(e){for(let t=1;t<=e.frames;t++){const r=e.imgs[e.imgs.push(new Image)-1];if(r.onload=this.onload(e),e.sprite){r.src=e.sprite;break}r.src=e.srcs.replace("#{frame}",("000"+t).slice(-3))}},V360.prototype.resizeCanvas=function(e,t){t.width=e.offsetWidth,t.height=e.offsetHeight},V360.prototype.resizeImage=function(e){const t=e.canvas.target,r=e.imgs,n=!!e.sprite,i=e.frames;for(let e=0,o=r.length;e<o;e++){const o=r[e];t.width<=t.height?(n&&(o.width=o.width/i),o.height=o.height*t.width/o.width,o.width=t.width,n&&(o.width=o.width*i)):(n&&(o.width=o.width/i),o.width=o.width*t.height/o.height,o.height=t.height,n&&(o.width=o.width*i))}},V360.prototype.setImage=function(e,t){const r=e.canvas.target,n=e.canvas.ctx,i=e.imgs,o=e.frames,s=!!e.sprite,a=i[s?0:t];if(n.clearRect(0,0,r.width,r.height),s){const e=-a.width/o*t,i=a.width/o;n.drawImage(a,e,0,a.width,a.height),n.clearRect(i,0,r.width-i,r.height)}else n.drawImage(a,0,0,a.width,a.height)},V360.prototype.V360DOM=function(e,t){const r=t.canvas.target,n=t.frames-1,i=this.onmousedown(t),o=this.onmouseup(t),s=this.onmousemove(t),a=this.onresize(t);let u;r.addEventListener("mousedown",i),window.addEventListener("mouseup",o),window.addEventListener("mousemove",s),window.addEventListener("resize",a),e.v360={played:!0},e.v360.start=(()=>{this.init(e),e.v360.played=!0}),e.v360.stop=(()=>{r.removeEventListener("mousedown",i),window.removeEventListener("mouseup",o),window.removeEventListener("mousemove",s),window.removeEventListener("resize",a),r&&r.remove(),e.v360.played=!1}),e.v360.restart=(()=>{e.v360.stop(),e.v360.start()}),e.v360.animate=((e,r,i="linear",o)=>{let s=performance.now(),a=0;t.allowDrag=!1,requestAnimationFrame(function c(m){let h=(m-s)/r,d=this.easingFunctions[i||"linear"](h);if(e==1/0||e==-1/0)~~h>a&&(a=~~h,t.currentFrame+=e==1/0?1:-1);else if(~~(d*Math.abs(e))>a){a=~~(d*Math.abs(e));let r=e/Math.abs(e),n=t.currentFrame+~~(d*e);t.currentFrame+=n/Math.abs(n)*r,console.log(t.currentFrame)}return t.currentFrame>n?t.currentFrame=0:t.currentFrame<0&&(t.currentFrame=n),this.setImage(t,t.currentFrame),u?t.allowDrag=!(u=!1):e==1/0?requestAnimationFrame(c.bind(this)):h<1?requestAnimationFrame(c.bind(this)):"function"==typeof o?o():void(t.allowDrag=!0)}.bind(this))}),e.v360.stopAnimation=(()=>u=!0)},V360.prototype.onload=function(e){return t=>{e.loadedImages++,e.loadedImages<e.frames&&!e.sprite||(this.resizeImage(e),this.setImage(e,e.currentFrame),this.onmousedown(e),this.onmouseup(e),this.onmousemove(e))}},V360.prototype.onmousedown=function(e){return t=>{e.allowDrag&&(e.mousePressing=!0,e.mouseStart=t.pageX)}},V360.prototype.onmousemove=function(e){return t=>{if(t.preventDefault(),!e.mousePressing)return;let r=(e.mouseStart-t.pageX)/e.dragSensitivity;if(r>1&&(r=1),r<-1&&(r=-1),1==r||-1==r){e.mouseStart=t.pageX;let n=Math.round(r);e.currentFrame+=n/Math.abs(n),e.currentFrame>e.frames-1&&(e.currentFrame=0),e.currentFrame<0&&(e.currentFrame=e.frames-1),this.setImage(e,e.currentFrame)}}},V360.prototype.onmouseup=function(e){return()=>{e.mousePressing=!1,e.mouseStart=0}},V360.prototype.onresize=function(e){return()=>{const t=e.target,r=e.canvas.target;if(r.width!=t.offsetWidth||r.height!=t.height){const n=e.currentFrame;this.resizeCanvas(t,r),this.resizeImage(e),this.setImage(e,n)}}},V360.prototype.restart=function(){const e=document.querySelectorAll("[v360], [V360]");for(let t=0,r=e.length;t<r;t++)e[t].v360.restart()},V360.prototype.set=function(e,t){e.setAttribute("v360",JSON.stringify(t).replace(/\"/g,"'")),this.init(e)},V360.prototype.start=function(){const e=document.querySelectorAll("[v360], [V360]");for(let t=0,r=e.length;t<r;t++)e[t].v360.start()},V360.prototype.stop=function(){const e=document.querySelectorAll("[v360], [V360]");for(let t=0,r=e.length;t<r;t++)e[t].v360.stop()};
//# sourceMappingURL=v360-min.js.map
