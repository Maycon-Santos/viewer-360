Object.prototype.merge=function(e){for(const t in e)this[t]=e[t]};class V360{constructor(){const e=document.querySelectorAll("[v360], [V360]");for(let t=0,r=e.length;t<r;t++)this.init(e[t])}init(e){if(e.v360&&e.v360.played)return e.v360.restart();const t={target:e,srcs:void 0,sprite:void 0,frames:0,dragSensitivity:5,canvas:this.appendCanvas(e),imgs:[],currentFrame:0,allowDrag:!0,mousePressing:void 0,mouseStart:0,loadedImages:0,allLoaded:!1};t.merge(JSON.parse(e.getAttribute("v360").replace(/\'/g,'"'))),this.preload(t),this.onresize(t),this.V360DOM(e,t)}}window.addEventListener("load",()=>window.v360=new V360),V360.prototype.appendCanvas=function(e){let t={};t.target=document.createElement("canvas"),this.resizeCanvas(e,t.target),t.ctx=t.target.getContext("2d");const r={webkitTouchCallout:"none",webkitUserSelect:"none",khtmlUserSelect:"none",mozUserSelect:"none",msUserSelect:"none",userSelect:"none",msTouchAction:"pan-y",touchAction:"pan-y"};return Object.keys(r).map(e=>t.target.style[e]=r[e]),e.appendChild(t.target),t},V360.prototype.easingFunctions={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}},V360.prototype.preload=function(e){for(let t=1;t<=e.frames;t++){const r=e.imgs[e.imgs.push(new Image)-1];if(r.onload=this.onload(e),e.sprite){r.src=e.sprite;break}r.src=e.srcs.replace("#{frame}",("000"+t).slice(-3))}},V360.prototype.resizeCanvas=function(e,t){t.width=e.offsetWidth,t.height=e.offsetHeight},V360.prototype.resizeImage=function(e){const t=e.canvas.target,r=e.imgs,n=!!e.sprite,o=e.frames;for(let e=0,a=r.length;e<a;e++){const a=r[e];n&&(a.realWidth=a.realWidth/o),a.height=a.realHeight*t.width/a.realWidth,a.width=t.width,(a.width>t.width||a.height>t.height)&&(a.height=t.height,a.width=a.realWidth*t.height/a.realHeight),n&&(a.width=a.width*o,a.realWidth=a.realWidth*o)}},V360.prototype.setImage=function(e,t){if(!e.allLoaded)return;const r=e.canvas.target,n=e.canvas.ctx,o=e.imgs,a=e.frames,i=!!e.sprite,s=o[i?0:t];if(n.clearRect(0,0,r.width,r.height),i){const e=-s.width/a*t,o=s.width/a;n.drawImage(s,e,0,s.width,s.height),n.clearRect(o,0,r.width-o,r.height)}else console.log(s,t),n.drawImage(s,0,0,s.width,s.height)},V360.prototype.V360DOM=function(e,t){const r=t.canvas.target,n=t.frames-1,o=this.onmousedown(t),a=this.onmouseup(t),i=this.onmousemove(t),s=this.onresize(t);let u;r.addEventListener("mousedown",o),window.addEventListener("mouseup",a),window.addEventListener("mousemove",i),r.addEventListener("touchstart",o),window.addEventListener("touchend",a),window.addEventListener("touchmove",i),window.addEventListener("resize",s),e.v360={played:!0},e.v360.start=(()=>{this.init(e),e.v360.played=!0}),e.v360.stop=(()=>{r.removeEventListener("mousedown",o),window.removeEventListener("mouseup",a),window.removeEventListener("mousemove",i),r.removeEventListener("touchstart",o),window.removeEventListener("touchend",a),window.removeEventListener("touchmove",i),window.removeEventListener("resize",s),r&&r.remove(),e.v360.played=!1}),e.v360.restart=(()=>{e.v360.stop(),e.v360.start()}),e.v360.animate=((e,r,o="linear",a)=>{let i=performance.now(),s=0;t.allowDrag=!1,requestAnimationFrame(function c(d){let h=(d-i)/r,l=this.easingFunctions[o||"linear"](h);if(e==1/0||e==-1/0)~~h>s&&(s=~~h,t.currentFrame+=e==1/0?1:-1);else if(~~(l*Math.abs(e))>s){s=~~(l*Math.abs(e));let r=e/Math.abs(e),n=t.currentFrame+~~(l*e);n=Math.abs(n/Math.abs(n)),r<0&&(n=-n),t.currentFrame+=n}return t.currentFrame>n?t.currentFrame=0:t.currentFrame<0&&(t.currentFrame=n),this.setImage(t,t.currentFrame),u?t.allowDrag=!(u=!1):e==1/0||e==-1/0?requestAnimationFrame(c.bind(this)):h<1?requestAnimationFrame(c.bind(this)):"function"==typeof a?a():void(t.allowDrag=!0)}.bind(this))}),e.v360.stopAnimation=(()=>u=!0),e.v360.onload=null},V360.prototype.onload=function(e){return t=>{e.loadedImages++,t.target.realWidth=t.target.width,t.target.realHeight=t.target.height,e.loadedImages<e.frames&&!e.sprite||(e.allLoaded=e.allowDrag=!0,this.resizeImage(e),this.setImage(e,e.currentFrame),"function"==typeof e.target.v360.onload&&e.target.v360.onload())}},V360.prototype.onmousedown=function(e){return t=>{e.allowDrag&&(e.mousePressing=!0,e.mouseStart=t.pageX||t.touches[0].screenX)}},V360.prototype.onmousemove=function(e){return t=>{if("touchmove"!=t.type&&t.preventDefault(),!e.mousePressing)return;const r=t.pageX||t.touches[0].screenX;let n=(e.mouseStart-r)/e.dragSensitivity;if(n>1&&(n=1),n<-1&&(n=-1),1==Math.abs(n)){e.mouseStart=r;let t=Math.round(n);e.currentFrame+=t/Math.abs(t),e.currentFrame>e.frames-1&&(e.currentFrame=0),e.currentFrame<0&&(e.currentFrame=e.frames-1),this.setImage(e,e.currentFrame)}}},V360.prototype.onmouseup=function(e){return()=>{e.mousePressing=!1,e.mouseStart=0}},V360.prototype.onresize=function(e){return()=>{const t=e.target,r=e.canvas.target;if(r.width!=t.offsetWidth||r.height!=t.height){const n=e.currentFrame;this.resizeCanvas(t,r),this.resizeImage(e),this.setImage(e,n)}}},V360.prototype.restart=function(){const e=document.querySelectorAll("[v360], [V360]");for(let t=0,r=e.length;t<r;t++)e[t].v360.restart()},V360.prototype.set=function(e,t,r){return e.setAttribute("v360",JSON.stringify(t).replace(/\"/g,"'")),this.init(e),e.v360.onload=r,e.v360},V360.prototype.start=function(){const e=document.querySelectorAll("[v360], [V360]");for(let t=0,r=e.length;t<r;t++)e[t].v360.start()},V360.prototype.stop=function(){const e=document.querySelectorAll("[v360], [V360]");for(let t=0,r=e.length;t<r;t++)e[t].v360.stop()};
//# sourceMappingURL=v360-min.js.map
