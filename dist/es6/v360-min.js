Object.prototype.merge=function(e){for(const t in e)this[t]=e[t]};class V360{constructor(){const e=document.querySelectorAll("[v360], [V360]");for(let t=0,s=e.length;t<s;t++)this.init(e[t])}init(e){const t={target:e,srcs:void 0,sprite:void 0,frames:0,dragSensitivity:5,canvas:this.appendCanvas(e),imgs:[],currentImg:0,mousePressing:void 0,mouseStart:0,loadedImages:0};t.merge(JSON.parse(e.getAttribute("v360").replace(/\'/g,'"'))),this.preload(t),this.onresize(t),this.V360DOM(e,t)}}window.addEventListener("load",()=>new V360),V360.prototype.appendCanvas=function(e){let t={};return t.target=document.createElement("canvas"),this.resizeCanvas(e,t.target),t.ctx=t.target.getContext("2d"),e.appendChild(t.target),t},V360.prototype.preload=function(e){for(let t=1;t<=e.frames;t++){const s=e.imgs[e.imgs.push(new Image)-1];if(s.onload=this.onload(e),e.sprite){s.src=e.sprite;break}s.src=e.srcs.replace("#{frame}",("000"+t).slice(-3))}},V360.prototype.resizeCanvas=function(e,t){t.width=e.offsetWidth,t.height=e.offsetHeight},V360.prototype.resizeImage=function(e,t){for(let s=0,r=t.length;s<r;s++){const n=t[s];e.width<=e.height&&r>1?(n.height=n.height*e.width/n.width,n.width=e.width):(n.width=n.width*e.height/n.height,n.height=e.height)}},V360.prototype.setImage=function(e,t,s,r,n){t.clearRect(0,0,e.width,e.height),s.length>1?t.drawImage(s[r],0,0,s[r].width,s[r].height):t.drawImage(s[0],-s[0].width/n*r,0,s[0].width,s[0].height)},V360.prototype.V360DOM=function(e,t){const s=this.onmousedown(t),r=this.onmouseup(t),n=this.onmousemove(t),o=this.onresize(t);t.canvas.target.addEventListener("mousedown",s),window.addEventListener("mouseup",r),window.addEventListener("mousemove",n),window.addEventListener("resize",o),e.V360={},e.V360.destroy=(()=>{t.canvas.target.removeEventListener("mousedown",s),window.removeEventListener("mouseup",r),window.removeEventListener("mousemove",n),window.removeEventListener("resize",o),t.canvas.target.remove()}),e.V360.start=(()=>this.init(e)),e.V360.restart=(()=>{e.V360.destroy(),e.V360.start()})},V360.prototype.onload=function(e){const t=e.canvas.target,s=e.canvas.ctx,r=e.imgs;return n=>{e.loadedImages++,e.loadedImages<e.frames&&!e.sprite||(this.resizeImage(t,r),this.setImage(t,s,r,e.currentImg,e.frames),this.onmousedown(e),this.onmouseup(e),this.onmousemove(e))}},V360.prototype.onmousedown=function(e){return t=>{e.mousePressing=!0,e.mouseStart=t.pageX}},V360.prototype.onmousemove=function(e){return t=>{if(t.preventDefault(),!e.mousePressing)return;let s=(e.mouseStart-t.pageX)/e.dragSensitivity;if(s>1&&(s=1),s<-1&&(s=-1),1==s||-1==s){e.mouseStart=t.pageX;let r=Math.round(s);e.currentImg+=r/Math.abs(r),e.currentImg>e.frames-1&&(e.currentImg=0),e.currentImg<0&&(e.currentImg=e.frames-1),this.setImage(e.canvas.target,e.canvas.ctx,e.imgs,e.currentImg,e.frames)}}},V360.prototype.onmouseup=function(e){return()=>{e.mousePressing=!1,e.mouseStart=0}},V360.prototype.onresize=function(e){return()=>{const t=e.target,s=e.canvas.target;if(s.width!=t.offsetWidth||s.height!=t.height){const r=e.canvas.ctx,n=e.imgs,o=e.currentImg;this.resizeCanvas(t,s),this.resizeImage(s,n),this.setImage(s,r,n,o,e.frames)}}};
//# sourceMappingURL=v360-min.js.map
